<div class="panel-group" id="accordion">
  <% for (var i = 0; i < products.length; ++i) { %>
  <%   var p = products[i]; %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#basic-info-<%= i %>" href="#basic-info-<%= i %>">
              [<%= p.guarantee_letter_code %>]<%= p.invest_purpose %>需求<%= p.needed_amount %>
            </a>
          </h4>
        </div>
				<%
					var offset = 4;
					if (session.User && session.User.admin) {
						offset = 3;
					}																			 
				%>
				<div class="col-md-offset-<%= offset %> col-md-1 haha-compact-col">
          <button class="btn btn-primary btn-xs btn-block" data-toggle="modal" data-target="#trans-<%= i %>">交易详情</button>
					<%- partial("../modals/transhist", { i: i, p: p }) %>
				</div>
        <div class="col-md-1 haha-compact-col">
          <button class="btn btn-success btn-xs btn-block invest-btn" modal-index="<%= i %>">投资</button>
          <%- partial("../modals/invest", { i: i, p: p }) %>
        </div>
				<% if (session.User && session.User.admin) { %>
				<div class="col-md-1 haha-compact-col">
          <a class="btn btn-danger btn-xs btn-block" href="/product/admin?subpage=update&product=<%= p.id %>">更新产品</a>
        </div>
				<% } %>
      </div>
    </div>
    <div id="basic-info-<%= i %>" class="panel-collapse collapse in">
      <table class="table table-condensed haha-table-compact">
        <thead>
          <tr>
            <th></th>
            <th>需求</th>
            <th>收益率</th>
            <th>期限</th>
            <th>投资开始</th>
            <th>投资截至</th>
            <th>状态</th>
            <th>进度</th>
            <th>还需</th>
            <th>担保机构</th>
            <th>担保函</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style=""></td>
            <td style=""><%= p.needed_amount %></td>
            <td style=""><%= p.interest %></td>
            <td style=""><%= p.duration_diff %>天</td>
            <td style=""><%= p.duration_from %></td>
            <td style=""><%= p.duration_to %></td>
            <td style=""><%= p.status %></td>
            <td style="width:20%;">
              <div class="progress haha-progress-compact haha-progress-center-span">
                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%= p.progress %>%;">
                  <span><%= p.progress %>%</span>
                </div>
              </div>
            </td>
            <td style=""><%= p.remain_amount %></td>
            <td style=""><%= p.guarantee_company %></td>
            <td style="">
              <button class="btn btn-default btn-xs" data-toggle="modal" data-target="#scan-<%= i %>">
                查看
              </button>
              <div class="modal fade" id="scan-<%= i %>" tabindex="-1" role="dialog" aria-labelledby="scan-label" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      担保函扫描件
                    </div>
                    <div class="modal-body">
                      <img class="img-responsive" src="<%= p.guarantee_letter_scan.replace(/^assets/, "") %>"></img>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <% } %>
</div>
