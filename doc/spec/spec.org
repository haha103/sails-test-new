#+STARTUP: showeverything
#+LANGUAGE: zh-CN
#+OPTIONS: creator:nil
#+TITLE: 需求说明书

* 引言

** 背景

** 产品愿景

** 参考文档

** 外部依赖

*** 第三方支付

    于可靠的第三方支付平台合作：支付宝或者银联

*** 短信解决方案

    短信验证功能所需的服务器发短信的功能有多种实现方式，各有利弊：

    1. 服务器连接一台安卓手机，使用ADB发短信
    2. 服务器连接一个GSM模块，使用该模块提供的接口发短信
    3. 购买电信服务商的短信网关服务


* 功能性需求

** 用户模块

*** 注册

    + 注册过程分为两步：
      1. 填写基本资料
      2. 邮箱验证
    + 注册时需要填写的基本资料包括：
      1. 用户名（登录名）：唯一
      2. 真实姓名
      3. 身份证号码：唯一
      4. 省份和城市
      5. 电子邮箱：唯一
      6. 登录密码
      7. 默认注册用户为普通用户
    + 注册提交需要输入正确的验证码
    + 客户端验证：
      1. 所有字段都做基本的简单格式检查
      2. 用户名、身份证号码、电子邮箱都应是唯一存在：AJAX异步从服务器端验证
      3. 登录密码需要重复输入验证
      4. 验证码也需要用AJAX异步验证
    + 提交注册基本资料之后，系统将会给注册时提供的电子邮箱发邮件，邮件内容包括：
      1. 标题大意：欢迎及完成注册邮件
      2. 内容大意：欢迎及邮箱验证地址链接。
    + 用户点击邮箱验证链接之后完成注册

*** 登录

    + 登录需要输入用户名、登录密码及验证码
    + 用户名和验证码需要作客户端验证
      - 纯客户端验证
      - AJAX异步验证
    + 出于安全考虑，不能保存登录状态：即使说，用户重开浏览器之后就必须重新登录。
    + 提供“找回密码”流程的入口链接

*** 主页

    + 账户余额
      - 显示当前账户余额。
      - 并提供充值、提现、转账按钮或者链接跳转到支付或者交易模块。
    + 账户安全状态
      - 简单明了的告知用户每个安全任务是否都已完成。
      - 并提供链接以便用户跳转到安全模块来完成或者修改安全任务。
    + 最近交易记录
      - 最近的10-15个用户交易或者支付记录
      - 提供链接以便用户查看所有交易记录
      - 核心功能由交易模块提供，用户模块只负责调用及显示。

*** 安全

    + 登录密码
      1. 如果用户的登录密码是简单密码，应该在用户登录后的醒目位置提醒用户使用强密码。
      2. 注意：不能明文记录用户密码，所以用户是否使用强密码需要用单独字段来记录。
      3. 用户每修改一次密码，都需要检查是否是强密码。
      4. 修改登录密码需要提供正确的旧密码。
    + 邮箱
      1. 注册时填写并且验证后的邮箱不能随意改动：如果实在需要改动，需要联系系统管理员来修改。
      2. 为了安全考虑，任何地方都不会显示该邮箱的完整地址，应该将部分字符打码后显示。如：
	 - 假如邮箱地址是：wliu272@163.com
	 - 那就应该显示成类似：w*****2@163.com的形式。
    + 手机
      1. 如果用户没有绑定手机，应该在用户登录后的醒目位置提醒用户手机未绑定
      2. 绑定手机用于需要更高安全性操作的短信验证
      3. 短信验证成功后绑定手机
      4. 需要考虑到短信发送成功率的因素，用户可以强制重发短信
      5. 每条短信应该设置失效时间，通常为1分钟。
    + 支付密码
      1. 必须为强密码
      2. 不能和登录密码相同
      3. 修改支付密码需要邮箱或者短信验证

** 产品模块

*** 权限控制

    + 只有系统管理员或者产品管理员才能新建或者修改产品
    + 所有人都能查看产品内容

*** 新建 & 修改

    每个新产品需要准确输入如下数据：

    + 合同编号
    + 贷款人：选择
    + 贷款用途
    + 贷款金额
    + 最低投资额
    + 投资者年化收益率
    + 平台年化收益率
    + 购买开始日期
    + 购买结束日期
    + 贷款期限：选择
    + 兑付方式：选择
    + 担保公司：选择
    + 担保函编号
    + 担保函扫描件：多个文件上传及预览

*** 查看

    + 除了平台年化收益率，产品录入时的字段能被所有用户查看
    + 为普通用户提供链接跳转到平台交易投资模块
    + 平台年化收益率只能被系统管理员或者产品管理员查看
    + 产品到期还款进度
      - 只有管理员才能查看
      - 提供链接或者按钮给管理员跳转到平台交易模块录入还款信息：还款金额，日期，流水号等重要银行字据信息。
    + 产品还款完成后的给投资者的兑付进度
      - 只有管理员才能查看
      - 提供链接或者按钮给管理员跳转到平台交易模块兑付给投资者

** 平台交易模块

   + 所有交易将生成并记录流水号以便以后查对。
   + 交易模块的所有操作都要求用户输入正确的支付密码。

*** 用户投资

    + 仅有普通用户能够投资产品。
    + 确认投资的产品信息。
    + 输入投资金额：金额必须大于等于对应产品的最小投资额。
    + 如果目标投资金额小于用户账户余额，引入支付模块功能共同完成投资。

*** 产品还款

    + 产品管理员操作。
    + 人工确认借款人还款之后，产品管理员将还款信息记录在系统中。
    + 还款信息包括：
      - 确认还款对应产品
      - 金额
      - 日期
      - 其他银行还款字据上的重要信息。

*** 到期兑付

    + 产品管理员操作。
    + 产品还款完成后，就能兑付给投资者本金及利息。
    + 注：这里需要输入管理员的支付密码。
    + 兑付之后的资金将直接进入投资者的余额，之后投资者可以通过支付模块的提现功能取出资金。
    + 兑付操作涉及的信息包括
      - 本次兑付的目标投资者名单（单个，多个或者所有）
      - 兑付金额确认（不同投资者的金额不尽相同，但是都应按照约定的年化利率兑付）
      - 流水号生成（每个流水号对应一个投资者）
      - 完成后验证及反馈兑付是否成功。
      - 其他信息？

*** 平台内转账

    首期低重要性功能。

** 在线支付模块

   + 所有在线支付操作都需要尽量详细的记录所有支付细节，以便查阅。

*** 充值

    1. 确认充值金额 & 确认支付密码
    2. 跳转到第三方支付服务商的页面完成支付
    3. 平台需要确认支付是否成功：用户支付的金额是否到帐
    4. 反馈成功信息给用户：成功后用户余额应立即增加相应金额

*** 提现

    1. 确认充值金额 & 确认支付密码
    2. 提示用户提现资金应该会在1-2个（？）工作日到帐，若还没到帐请马上联系我们。
    3. 平台账户转账到用户绑定的银行卡上，需要用到用户的真实姓名。所以还需提醒用户，如果他们没有提供实名，提现操作将不会成功。
    4. 提现之后，账户余额立即减少相应金额，但是提现操作详细信息需要记录在

*** 人工服务

    1. 管理员可以查阅尽量所有的平台交易及支付记录
    2. 以便在用户支付操作遇到困难时，可以提供人工的确认，尽快保证用户资金安全。

** 字典模块

*** 用户角色

    + 普通用户
    + 系统管理员
    + 产品管理员

*** 地区字典
    
    + 省份
    + 城市
    + 区

*** 贷款人

    + 贷款人姓名或公司名称

*** 担保公司

    + 担保公司名称

*** 产品状态

    + 筹款中
    + 筹款结束
    + 到期还款中
    + 到期兑付中
    + 结束

*** 到期兑付方式

    + 

** 统计模块

*** 用户统计模块

    + 

*** 管理统计模块

** 帮助模块

*** 联系方式

    留下联系方式以便用户有疑问或困难时能联系我们：

    + 联系电话
    + 电子邮箱

*** 留言

    + 首期低重要性功能。
    + 类似于简单的论坛，用户留言，管理员回复。所有人都能看到别人的留言及回复。
    + 需要提供简单的过滤功能：如找出所有自己的留言、全文搜索等。

*** 在线帮助

    + 首期低重要性功能。
    + 实时在线帮助。
    + 需要有历史记录。

** 公告模块

   + 主页显示最新5-10个公告标题列表。
   + 单独页面显示所有公告（分页）
     - 公告详细信息的链接：所有用户可见
     - 公告管理链接（删除，修改等）：管理员可见
   + 公告内容包括：
     - 发布日期
     - 标题
     - 发布者
     - 详细内容


* 非功能性需求

** 平台及框架

   + Linux平台
   + 任何成熟的MVC框架皆可
   + 成熟可靠的RDBMS：MySQL或者PostgreSQL
   + 部署在成熟可靠的web server（Apache或者Nginx）或者app server上。

** 安全

   + 为了简便的保证用户所有敏感信息的安全，全应用都应使用SSL用以加密所有通信。这样会造成性能上的损失，但是基于现有的分析，应该不会大幅降低用户体验，所以暂时不对此进行优化。
   + 必须保证数据一致性和完整性：
     - 对于一次性多个数据库操作，全面事务处理
     - 重点设计所有涉及交易和支付操作的异常处理

** 性能

   没有特殊性能需求

** 兼容性

*** PC & Mac

    |-----------------------------+----|
    | Microsoft Internet Explorer | 8+ |
    | Firefox                     |    |
    | Chrome                      |    |
    | Safari                      |    |
    |-----------------------------+----|

*** Mobile Devices

    + 平板电脑
    + 手机
